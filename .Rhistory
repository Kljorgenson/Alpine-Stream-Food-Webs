setwd("C://Users//Karen Jorgenson//OneDrive - University of Wyoming//Collins Lab//Teton Alpine Streams//Github//Alpine-Stream-Food-Webs")
# Setup
library(tidyverse)
install.packages("rlang")
# Setup
library(tidyverse)
install.packages("rlang")
# Setup
library(tidyverse)
install.packages("dbplyr")
# Setup
library(tidyverse)
library(viridis)
library(DirichletReg)
library(ggtern)
## Create dataframe with diet proportions and biomass
# Load diversity data
div_d <- read.csv("Data//TetonInverts2020.csv")
head(div_d)
# Change taxa to match diet taxonomic groups
div_dat <- div_d %>% mutate(taxa = case_when(startsWith(Taxa, "Rhy") ~ "Rhyacophilidae",
Taxa %in% c("Simuliidae Pupae", "Heterocloeon", "Prosimuliium", "Helodon") ~ "Simuliidae",
Taxa == "Non-Tanypodinae" ~ "Midges",
Taxa == "Chironomidae Pupae" ~ "Midges",
Taxa == "Tipula (Arctotipula)" ~ "Tipula",
Taxa %in% c("1Megarcys", "2Megarcys") ~ "Megarcys",
Taxa == "Nematoda" ~ "Oligochaeta",
!Taxa %in% c("Rhyacophilidae", "Simuliidae Pupae", "Heterocloeon", "Prosimuliium", "Helodon", "Chironomidae Pupae", "Non-Tanypodinae", "Tipula (Arctotipula)","1Megarcys", "2Megarcys") ~ Taxa   )) %>%
select(Stream, taxa, Biomass_mg_m2) %>% filter(taxa != "Chironomidae Adult") %>% rename(site = Stream)
div_dat
# Rename stream names so that they match
div_dat$site <- as.factor(div_dat$site)
levels(div_dat$site) <- c("AK Basin",  "Cloudveil", "Delta", "Grizzly", "Middle Teton", "NFTC",
"Paintbrush", "SFTC", "Skillet", "South Cascade RG", "The Gusher", "Wind Cave")
# Merge biomass and diet proportions data
data_di <- read.csv("Data//diet_data_clean.csv")
data_di$site <- as.factor(data_di$site)
levels(data_di$site) <- c("AK Basin","Cloudveil","Delta","Grizzly","NFTC", "Paintbrush", "SFTC", "Skillet", "Wind Cave" )
head(data_di)
diet_bm_dat <- merge(data_di, div_dat)
head(diet_bm_dat)
diet_bm_dat$Biomass_mg_m2 <- as.numeric(diet_bm_dat$Biomass_mg_m2)
diet_bm_dat %>% filter(site == "Cloudveil", source == "Biofilm") %>% summarise(sum = sum(Biomass_mg_m2, na.rm = TRUE))
## Calculate biomass supported by each food source
diet_bm_dat$biomass_t = diet_bm_dat$Biomass_mg_m2*diet_bm_dat$Mean # Biomass per source per taxa
head(diet_bm_dat)
div_dat
diet_bm_dat %>% filter(site == "Cloudveil") %>% summarise(tot = sum(biomass_t)) # Check that it sums to 100
diet_bm_dat %>% group_by(site, taxa, source, Mean) %>% summarise(biomass = sum(Biomass_mg_m2),
biomass_t = biomass*Mean)
div_dat$Biomass_mg_m2 <- as.numeric(div_dat$Biomass_mg_m2)
site_bm <- diet_bm_dat %>% group_by(site, source) %>% summarise(biomass_ss = sum(biomass_t, na.rm = TRUE)) # Total biomass at site by source
bm_dat_site <- diet_bm_dat %>% group_by(site) %>% summarise(biomass_s = sum(biomass_t, na.rm = TRUE))
bm_dat <- merge(site_bm, bm_dat_site, all = TRUE)
bm_dat$biomass_per <- bm_dat$biomass_ss/bm_dat$biomass_s # % Biomass by resource
bm_dat %>% ggplot(aes(site, biomass_per, color = source)) + geom_point()
# add zeroes for Hydrurus
site <- c("SFTC", "Grizzly", "Paintbrush")
Hy_add <- data.frame(site = c("SFTC", "Grizzly", "Paintbrush"),  source = rep("Hydrurus", 3), biomass_per = rep(0, 3))
bm_data <- dplyr::bind_rows(bm_dat, Hy_add)
# load environmental data and merge
Envi_data <- read.csv("Data//Envi_data.csv")
# load environmental data and merge
Envi_data <- read.csv("Data//Environ_data.csv")
Envi_data
bm_envi_dat <- merge(Envi_data, bm_data, all = TRUE)
# make data long
bm_envi_dat_long <- bm_envi_dat %>% gather(env_var, value, Elevation:H)
